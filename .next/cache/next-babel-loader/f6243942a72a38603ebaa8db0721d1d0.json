{"ast":null,"code":"import _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component, Fragment } from 'react';\nimport axios from 'axios';\nimport Pusher from 'pusher-js';\nimport Layout from '../components/Layout';\nimport ChoosePersona from '../components/ChoosePersona';\nimport Map from '../components/Map';\nimport NearbyFriends from '../components/NearbyFriends';\n\nvar IndexPage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(IndexPage, _Component);\n\n  function IndexPage() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, IndexPage);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(IndexPage)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      id: null,\n      people: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"endConnection\", function () {\n      _this.pusher.disconnect();\n\n      axios.post(\"/offline/\".concat(_this.state.id));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"personaSelected\", function (id) {\n      _this.setState({\n        id: id\n      });\n\n      axios.post(\"/online/\".concat(id));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"regionFiltered\", function (people) {\n      return _this.nearby.updatePeople(people);\n    });\n\n    return _this;\n  }\n\n  _createClass(IndexPage, [{\n    key: \"componentWillMount\",\n    // This happens before mounting occurs and called before render\n    value: function componentWillMount() {\n      this.pusher = new Pusher(process.env.PUSHER_APP_KEY, {\n        cluster: process.env.PUSHER_APP_CLUSTER,\n        encrypted: true\n      });\n      this.channel = this.pusher.subscribe('map-geofencing');\n    } // fetch the people collection from the server by making a GET HTTP request using axios to the /people endpoint.\n    // We then update the state with the people collection gotten from the response.\n\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      axios.get('/people').then(function (_ref) {\n        var data = _ref.data;\n        var _data$people = data.people,\n            people = _data$people === void 0 ? [] : _data$people;\n\n        _this2.setState({\n          people: people\n        });\n      });\n      window.onbeforeunload = this.endConnection;\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.endConnection();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          id = _this$state.id,\n          people = _this$state.people;\n      var person = people.find(function (person) {\n        return person.id === id;\n      }) || {};\n      var peopleOffline = people.filter(function (person) {\n        return !person.online;\n      });\n      return __jsx(Layout, {\n        pageTitle: \"Realtime Geofencing\"\n      }, __jsx(\"main\", {\n        className: \"container-fluid position-absolute h-100 bg-light\"\n      }, id ? __jsx(\"div\", {\n        className: \"row position-absolute w-100 h-100\"\n      }, __jsx(\"section\", {\n        className: \"col-md-9 px-0 border-right border-gray position-relative h-100\"\n      }, __jsx(Map, {\n        person: person,\n        radius: 1000,\n        people: people,\n        channel: this.channel,\n        onRegionFiltered: this.regionFiltered\n      })), __jsx(\"section\", {\n        className: \"col-md-3 position-relative d-flex flex-wrap h-100 align-items-start align-content-between bg-white px-0\"\n      }, __jsx(NearbyFriends, {\n        ref: function ref(elem) {\n          return _this3.nearby = elem;\n        },\n        person: person\n      }))) : __jsx(ChoosePersona, {\n        count: 5,\n        people: peopleOffline,\n        onSelected: this.personaSelected\n      })));\n    }\n  }]);\n\n  return IndexPage;\n}(Component);\n\n;\nexport default (function () {\n  return __jsx(IndexPage, null);\n});","map":null,"metadata":{},"sourceType":"module"}